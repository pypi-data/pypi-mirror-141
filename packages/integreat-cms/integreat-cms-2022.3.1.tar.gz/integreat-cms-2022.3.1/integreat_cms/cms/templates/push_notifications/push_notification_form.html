{% extends "_base.html" %}
{% load i18n %}
{% load static %}
{% load widget_tweaks %}
{% load push_notification_filters %}
{% load page_filters %}
{% load rules %}
{% block content %}
    <form method="post" data-unsaved-warning>
        {% csrf_token %}
        <div class="flex flex-wrap">
            <div class="w-full flex flex-wrap justify-between gap-4 mb-6">
                <h1 class="heading">
                    {% if push_notification_form.instance.id %}
                        {% with push_notification_form.instance as push_notification_title %}
                            {% blocktrans %}Edit push notification "{{ push_notification_title }}"{% endblocktrans %}
                        {% endwith %}
                    {% else %}
                        {% trans 'Create news message' %}
                    {% endif %}
                </h1>
                <div class="flex flex-wrap gap-4">
                    {% if perms.cms.change_pushnotification %}
                        <button name="submit_save" class="btn btn-gray">{% trans 'Save' %}</button>
                    {% endif %}
                    {% if perms.cms.send_push_notification %}
                        <button name="submit_send" class="btn">{% trans 'Save & Send' %}</button>
                    {% endif %}
                </div>
            </div>
            <div class="flex flex-wrap flex-col grow pr-4 tabbed">
                <ul class="flex flex-wrap pl-4 cursor-pointer text-black">
                    {% for other_language in languages %}
                        <li id="li-{{ other_language.id }}"
                            class="language-tab-header mr-2 -mb-[2px] {% if other_language.id == language.id %} z-10 text-blue-500 bg-white cursor-default {% else %} bg-water-500 {% endif %} hover:text-blue-500 hover:bg-white border-l border-t border-r border-blue-500 font-bold rounded-t-lg"
                            data-switch-language="{{ other_language.id }}">
                            <div class="border-b-2 border-white">
                                <div class="p-4">
                                    {{ other_language.translated_name }}
                                    <span class="fp fp-rounded fp-{{ other_language.primary_country_code }}"></span>
                                    {% if other_language.secondary_country_code %}
                                        <span class="fp fp-rounded fp-{{ other_language.secondary_country_code }}"></span>
                                    {% endif %}
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
                <figure>
                    {{ pnt_formset.management_form }}
                    {% for form in pnt_formset %}
                        <div id="tab-{{ form.language.value }}"
                             class="language-tab-content w-full mb-4 rounded border border-blue-500 bg-white flex-auto {% if form.language.value|add:0 != language.id|add:0 %}hidden{% endif %}">
                            <div class="w-full p-4">
                                {{ push_notification_translation_form.errors }}
                                <label for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
                                {% render_field form.title %}
                                <label for="{{ form.text.id_for_label }}">{{ form.text.label }}</label>
                                {% render_field form.text %}
                                <p>
                                    <span class="input-length-counter"></span>/{{ form.fields.text.max_length }}
                                </p>
                                <div class="hidden">
                                    {% render_field form.id %}
                                    {% render_field form.language %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </figure>
            </div>
            <div class="w-[400px] flex flex-wrap flex-col">
                <div class="rounded border border-blue-500 shadow-2xl bg-white">
                    <div class="rounded p-4 bg-water-500">
                        <h3 class="heading font-bold text-black">
                            <i data-feather="settings" class="pb-1"></i>
                            {% trans "Settings" %}
                        </h3>
                    </div>
                    <div class="p-4 rounded bg-white">
                        <label for="{{ push_notification_form.channel.id_for_label }}">{{ push_notification_form.channel.label }}</label>
                        {% render_field push_notification_form.channel %}
                        <label for="{{ push_notification_form.mode.id_for_label }}">{{ push_notification_form.mode.label }}</label>
                        {% render_field push_notification_form.mode %}
                    </div>
                </div>
            </div>
        </div>
    </form>
{% endblock content %}
