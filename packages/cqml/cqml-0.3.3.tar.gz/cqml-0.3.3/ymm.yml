# - install
# - test
# - watch
# - release
# - dev
_env:
    JOB: 327
    REPO: 898875077533893
    URL: https://nauto-biz-prod-us.cloud.databricks.com/?o=4194856255001463#job/327
install:
    - pip3 install -r requirements.txt
build:
    - pip3 install --upgrade pytest
    - pip3 install --upgrade pytest-watch
    - pip3 install --upgrade build
    - pip3 install --upgrade twine

test:
    - python3 -m pytest

watch:
    - echo Use `ptw`

release:
    - echo Must update CHANGELOG in order to bump version
    - prerelease --no-input
    - cat version.txt
    - release --no-input
    - python3 -m build
    - python3 -m twine upload dist/*
    - postrelease --no-input
    - cat version.txt

bump-dev:
    - cat version.txt
    - awk -Fv {{printf("%sv%d\n",$1,$2+1)}} version.txt
    - sed -i .prev s/{^^}/{^}/ version.txt

dev:
    - $bump-dev
    - cat version.txt
    - git commit -am {^}
    - git push

db:
   - date -u +"%Y-%m-%dT%H:%M:%SZ"
   - git commit -am {^}
   - git push
   - git rev-parse --abbrev-ref HEAD
   - databricks repos update --repo-id 898875077533893 --branch {^}
   - databricks jobs run-now --job-id 327
   - open https://nauto-biz-prod-us.cloud.databricks.com/?o=4194856255001463#job/327
